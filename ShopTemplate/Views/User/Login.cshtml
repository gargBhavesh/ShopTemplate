@inject Microsoft.AspNetCore.Http.IHttpContextAccessor httpContextaccessor
@{
    ViewData["Title"] = "Login";

    if (httpContextaccessor.HttpContext.Request.Cookies["UserId"] != null){
        ViewData["IsCookie"] = true;
        ViewData["CookieVal"] = httpContextaccessor.HttpContext.Request.Cookies["UserId"];
        ViewData["CookiePwd"] = httpContextaccessor.HttpContext.Request.Cookies["Password"];

    }
    else{
        ViewData["IsCookie"] = false;
        ViewData["CookieVal"] = "";
        ViewData["CookiePwd"] = "";
    }
    if (TempData.ContainsKey("loginStatus")) {
        if ((bool)TempData["loginStatus"] == false) {
            string loginErrMag = TempData["loginError"].ToString();
            @section scripts{
                <script>
                    $("#validationSummary").attr('class','validation-summary-errors')
                    $("#validationSummary").html('<p>@loginErrMag</p')
                </script>
            }
            TempData.Remove("loginError");
        } 
        TempData.Remove("loginStatus"); 
    }
}
<div class="bg-body">
    <div class="d-flex flex-column flex-root" id="kt_body1">
        <div class="d-flex flex-column flex-lg-row flex-column-fluid">
            <div class="d-flex flex-column flex-lg-row-fluid py-10 gradient-bg" style="flex: 1 auto; min-width: 0;">
                <div class="d-flex flex-center flex-column flex-column-fluid">
                    <div class="w-lg-400px p-10 p-lg-10 mx-auto bg-white no-auth" style="border-radius: 8px;">
                        <form class="form w-100 fv-plugins-bootstrap5 fv-plugins-framework" id="kt_sign_in_form" method="post" asp-action="Login">
                            <div class="mb-5">
                                <a href="https://shopivana.com" target="_blank" class="pb-10 d-block">
                                    <img alt="Logo" src="https://app.shopivana.com/Content/images/logo_default_dark.png?1.0.2.4" class="h-60px">
                                </a>
                                <p class="text-dark mb-5 fs-1">Login</p>
                                <p class="text-gray-700 mb-0">Log in to Shopivana to continue to the magic.</p>
                            </div>
                            
                            <div class="fv-row mb-5 fv-plugins-icon-container">
                                <label class="position-relative w-100">
                                    @{
                                        if ((bool)ViewData["IsCookie"])
                                        {
                                            <input class="input__field no-auth-input"  type="text" id="Email" name="Email" placeholder=" " value ="@ViewData["CookieVal"]" autocomplete="off" readonly onfocus="$(this).removeAttr('readonly');" onblur="$(this).attr('readonly');" onchange="    return validateEmailField();">
                                    
                                        }
                                        else
                                        {
                                            <input class="input__field no-auth-input"  type="text" id="Email" name="Email" placeholder=" " autocomplete="off" readonly onfocus="$(this).removeAttr('readonly');" onblur="$(this).attr('readonly');" onchange="    return validateEmailField();">
                                        
                                        }
                                    }
                                    <span class="input__label">Email address</span>
                                </label>
                                <div class="fv-plugins-message-container invalid-feedback" id="emailfeedback">

                                </div>
                            </div>
                            <div class="fv-row mb-5 fv-plugins-icon-container">
                                <label class="position-relative w-100">
                                    @{
                                        if ((bool)ViewData["IsCookie"])
                                        {
                                            <input class="input__field no-auth-input" required type="password" id="Password" name="Password" value ="@ViewData["CookiePwd"]" placeholder=" " autocomplete="off" readonly onfocus="$(this).removeAttr('readonly');" onblur="$(this).attr('readonly');" onchange="    return validatePasswordField();">
                                        }
                                        else
                                        {
                                            <input class="input__field no-auth-input"  required type="password" id="Password" name="Password"  placeholder=" " autocomplete="off" readonly onfocus="$(this).removeAttr('readonly');" onblur="$(this).attr('readonly');" onchange="    return validatePasswordField();">
                                        }
                                    }
                                    <span class="input__label">Password</span>
                                    <span class="btn btn-sm btn-icon position-absolute translate-middle top-50 end-0 me-n2" onclick="showPassword(this)">
                                        <i class="bi bi-eye-slash fs-5"></i>
                                    </span>
                                </label>
                                <div class="fv-plugins-message-container invalid-feedback" id="passwordfeedback">

                                </div>
                            </div>
                            <div class="row">
                                    <div class="col-md-6">
                                        <a asp-controller="User" asp-action="ForgotPassword" class="link-primary fs-6">Forgot password?</a>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="checkbox" for="Remember Me" id="rememberMe" name="rememberMe" />
                                        <span >Remember Me</span>
                                    </div>

                            </div>
                            
                            <div class="fv-row mb-5 fv-plugins-icon-container">
                                <div class="validation-summary-valid" data-valmsg-summary="true" id="validationSummary">
                                <p style="display:none"></p>
                            </div>
                            </div>
                            
                            <div class="text-left">
                                <button type="button" id="kt_sign_in_submit" class="btn btn-lg btn-primary w-100 my-4" onclick = "return submitForm();">
                                    <span class="indicator-label">Login</span>
                                    <span class="indicator-progress" id = "spinnerSpan" style ="display:true">
                                        Please wait...
                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                    </span>
                                </button>
                                
                                Don't have an account?&nbsp;<a asp-area="" asp-controller="User" asp-action="RegisterUser" class="link-primary">Sign up</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
        

        $(document).ready(function () {
                $("#Email").focus();
                displayToggle("#spinnerSpan")
            
        });
        function validateEmailField() {
            returnVal = true
            if ($("#Email").val().trim() == "") {
                $("#emailfeedback").html('<div data-field="Email" data-validator="notEmpty">Email address is required </div>')
                returnVal = false

            }
            else {
                valEmailVal = ValidateEmail($("#Email").val().trim())
                if (valEmailVal == false) {
                    $("#emailfeedback").html('<div data-field="Email" data-validator="notEmpty">Please enter a valid EmailId</div>')
                    returnVal = false
                } else { 
                    $("#emailfeedback").html('')
                }
                
            }
            return returnVal
        }
        function validatePasswordField() { 
            returnVal = true
            if ($("#Password").val().trim() == "") {
                $("#passwordfeedback").html('<div data-field="Password" data-validator="notEmpty">Password is required </div>')
                returnVal = false

            } else {
                $("#passwordfeedback").html('')
            }
            return returnVal
        }
        function validate(){
            returnVal =true
            $("#validationSummary").attr('class','validation-summary-valid')
            $("#validationSummary").html('<p style="display:none"></p>')
            
            retEmailVal = validateEmailField()
            retPassVal = validatePasswordField()
            returnVal = retEmailVal &  retPassVal 
            return returnVal
        }
        function submitForm(){
           
            retVal = validate()
            if (retVal == true) {
                $("#kt_sign_in_form").submit()
                return true
            }
            return false

        }
        
       
            </script>