@{
    ViewData["Title"] = "Sign Up";
    if (TempData.ContainsKey("errorMsg")) {
        if (TempData["errorMsg"].ToString() != "" ||  TempData["errorMsg"].ToString()!=null) {
            string errorMsg = TempData["errorMsg"].ToString();
            @section scripts{
                <script type="text/javascript">
                    $("#validationSummary").attr('class','validation-summary-errors')
                    $("#validationSummary").html('<p>@errorMsg</p>')
                </script>
            }
            TempData.Remove("errorMsg");
        }
        
    }
}

<div>
    <div class="d-flex flex-column flex-root" id="kt_body1">
        <div class="d-flex flex-column flex-lg-row flex-column-fluid">
            <div class="d-flex flex-column flex-lg-row-fluid py-10 gradient-bg" style="flex: 1 auto; min-width: 0;">
                <div class="d-flex flex-center flex-column flex-column-fluid">
                    <div class="w-lg-400px p-10 p-lg-10 mx-auto bg-white no-auth" style="border-radius: 8px;">
                        <form class="form w-100 fv-plugins-bootstrap5 fv-plugins-framework" method="post" id="kt_sign_up_form" asp-action="RegisterUser">
                            <div class="mb-5">
                                <a href="https://shopivana.com" target="_blank" class="pb-10 d-block">
                                    <img alt="Logo" src="https://app.shopivana.com/Content/images/logo_default_dark.png?1.0.2.4" class="h-60px">
                                </a>
                                <p class="text-dark mb-5 fs-1">Sign Up</p>
                                <p class="text-gray-700 mb-0">Sign Up to Shopivana for free.</p>
                            </div>

                            <div class="mb-5">
                                <div class="validation-summary-valid" data-valmsg-summary="true" id="validationSummary">
                                    <p style="display:none"></p>
                                </div>
                            </div>

                            <div class="mb-5">
                                <div class="mb-5 fv-plugins-icon-container">
                                    <label class="position-relative w-100">
                                        <input type="text" class="input__field no-auth-input" id="EmailId" name="EmailId" autocomplete="off" placeholder=" " readonly onfocus="$(this).removeAttr('readonly');" onblur="$(this).attr('readonly');" onchange="    return validateEmailField();"/>
                                        <span class="input__label">Email Id</span>
                                    </label>
                                    <div class="fv-plugins-message-container invalid-feedback" id="emailfeedback">

                                    </div>
                                </div>
                            </div>
                            <div class="mb-5">
                                <div class="mb-5 fv-plugins-icon-container">
                                    <label class="position-relative w-100">
                                        <input type="password" class="input__field no-auth-input" id="Password" name="Password" autocomplete="off" placeholder=" " readonly onfocus="$(this).removeAttr('readonly');" onblur="$(this).attr('readonly');" onchange="    return validatePasswordField();"/>
                                        <span class="input__label">Password</span>
                                        <span class="btn btn-sm btn-icon position-absolute translate-middle top-50 end-0 me-n2" onclick="showPassword(this)">
                                            <i class="bi bi-eye-slash fs-5"></i>
                                        </span>
                                    </label>
                                    <div class="fv-plugins-message-container invalid-feedback" id="passwordfeedback">

                                    </div>
                                </div>
                            </div>
                            <div class="text-left">
                                <button type="button" id="kt_sign_in_submit" class="btn btn-lg btn-primary w-100 my-4" onclick = "    return submitForm();">
                                    <span class="indicator-label" id="continueButton">Continue</span>
                                    <span class="indicator-progress" id ="spinnerSpan" >
                                        Please wait...
                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                    </span>
                                </button>
                                
                            </div>
                            <div class="text-center">
                           <a asp-controller="User" asp-action="Login">Back to Login</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
        $(document).ready(function () {
            $("#EmailId").focus();
            displayToggle("#spinnerSpan")
        });
        function validateEmailField() {
            returnVal = true
            $("#validationSummary").attr('class','validation-summary-valid')
            $("#validationSummary").html('<p style="display:none"></p>')
            if($("#EmailId").val().trim() == ""){
                $("#emailfeedback").html('<div data-field="Email" data-validator="notEmpty">Email address is required </div>')
                return false
            }
            else{
                valEmailVal = ValidateEmail($("#EmailId").val().trim())
                if (valEmailVal == false) {
                    $("#emailfeedback").html('<div data-field="Email" data-validator="notEmpty">Please enter a valid EmailId</div>')
                    return false
                } else { 
                    $("#emailfeedback").html('')
                }
            }
            var checkEmailFlag = checkIfEmailExist()
            
            return checkEmailFlag
        }
        function validatePasswordField() { 
            returnVal = true
            if($("#Password").val().trim() == ""){
                $("#passwordfeedback").html ('<div data-field="Password" data-validator="notEmpty">Password is required </div>')
                returnVal=false
                
            }
            else {
                $("#passwordfeedback").html('')
            }
            return returnVal
        }

        function validate(){
            returnVal =true
            $("#validationSummary").attr('class','validation-summary-valid')
            $("#validationSummary").html('<p style="display:none"></p>')
            retEmailVal = validateEmailField()
            retPassVal = validatePasswordField()
            returnVal = retEmailVal &  retPassVal
            return returnVal
        }
        function submitForm(){
            retVal = validate()
            
            if(retVal==true){
                $("#kt_sign_up_form").submit();
                return true
            }
            else{
                return false
            }
        }
       function checkIfEmailExist() {
           var returnVal = false
            if ($("#EmailId").val() !== "") {
                $.ajax({
                    url: '/User/CheckEmailExists',
                    type: 'POST',
                    async: false,
                    cache: false,
                    data: { EmailId: $("#EmailId").val() },
                    beforeSend: function(){
                         displayToggle("#spinnerSpan")
                         displayToggle("#continueButton")

                    },
                    complete: function(){
                        displayToggle("#spinnerSpan")
                         displayToggle("#continueButton")
                    },
                    success: function (returnData) {
                        console.log(returnData)
                        if(returnData.status) {
                            $("#emailfeedback").html('')
                            returnVal = true
                        }
                        else {
                            $("#emailfeedback").html('<div data-field="Email" data-validator="notEmpty">'+returnData.errorMsg+'</div>')
                            
                        }
                    },
                    error: function() { alert('Oops! Something went wrong'); }
                });
            }
            
            return returnVal
        }     
            </script>


